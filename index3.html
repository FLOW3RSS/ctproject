<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¹„ë²„ì±Œë¦°ì§€: AI ê°•ìˆ˜í™•ë¥  ê¸°ë°˜ ìš°ì‚° ì˜ˆì¸¡ê¸°</title>
  <style>
    body { font-family: 'Segoe UI', 'Arial'; background: #f2f9ff; padding: 20px; line-height: 1.68; }
    h1, h2 { color: #003366; }
    h1 { font-size: 2.2rem; letter-spacing: 0.5px; }
    h2 { font-size: 1.18rem; margin-bottom: 16px;}
    .section { margin-bottom: 19px; }
    .problem-box { border: 2.2px solid #3399cc; background: #e0f7ff; padding: 20px 16px 16px 16px; margin-bottom: 22px; border-radius: 13px;}
    label { font-weight: bold; margin-right: 5px;}
    .btn { padding: 8px 20px; background: #1976d2; color: white; border: none; cursor: pointer; margin: 6px 0 0 0; border-radius: 7px; font-weight: 500; letter-spacing: 0.5px; transition: background 0.2s;}
    .btn:disabled { background: #b0b7c7; cursor: not-allowed;}
    .btn:hover:not(:disabled) { background: #12519c;}
    .result { margin-top: 13px; padding: 11px; font-weight: bold; border-radius: 8px; }
    .í•„ìˆ˜ { background: #ffcdd2; color: #b71c1c; border-radius:4px; padding:0 4px;}
    .ê¶Œì¥ { background: #fff9c4; color: #827717; border-radius:4px; padding:0 4px;}
    .ì„ íƒ { background: #c8e6c9; color: #1b5e20; border-radius:4px; padding:0 4px;}
    #map { height: 265px; margin-bottom: 15px; border-radius: 10px; box-shadow: 1px 2px 7px #bcd4e4;}
    .chart-switch { margin-bottom: 8px; }
    .chart-switch button { padding: 7px 20px; border-radius: 8px; margin-right: 7px; border: none; background: #e3e7f7; color: #234; font-weight: bold; cursor: pointer; transition: background 0.18s;}
    .chart-switch .selected { background: #1976d2; color: white;}
    canvas { margin-top: 9px; background: white; border: 1px solid #ccc; border-radius:9px;}
    .qbox { margin-top: 29px; border: 2px solid #8eb2ff; background: #eef4fd; border-radius: 13px; padding: 18px;}
    .qtitle { font-weight:bold; color: #0c2461; font-size: 20px; margin-bottom: 11px;}
    .qdesc { color:#3e4b77; margin-bottom: 9px; font-size:16px;}
    .qrule { background: #f7faff; border-left: 4px solid #1976d2; padding: 7px 12px; margin: 8px 0 14px 0; font-size:15px;}
    .choices button { margin: 8px 4px 7px 4px; padding: 9px 24px; font-weight: bold; border-radius: 8px; font-size:1.04rem;}
    .ansMsg { margin-top: 10px; font-weight: bold;}
    .progress-container { height: 12px; background: #e3e6ee; margin-top: 13px; border-radius: 8px; overflow: hidden;}
    .progress-bar { height: 12px; background: linear-gradient(90deg, #1976d2 85%, #42a5f5 100%); width: 100%; transition: width 1s linear;}
    .timer-row { font-size: 17px; color: #30306a; font-weight:bold; margin: 13px 0 8px 0;}
    select { font-size: 17px; margin-left: 9px; padding: 4px 15px; border-radius: 7px; border: 1.7px solid #8eb2ff;}
    .choice-tbl { border-collapse: collapse; width: 385px; margin: 13px 0 8px 0; border-radius:7px; overflow:hidden;}
    .choice-tbl th, .choice-tbl td { border: 1px solid #b9d0f7; padding: 5px 11px; text-align:center; }
    .choice-tbl th { background: #c8d9fc; }
    .not-started { opacity: 0.35; pointer-events: none;}
    .started { opacity: 1; pointer-events: auto;}
    .popup { display: none; position: fixed; top: 36%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #3399cc; border-radius:14px; padding: 34px 45px; z-index: 999; text-align: center; font-size: 19px;}
    .popup button { margin-top: 18px; padding: 10px 26px; border-radius: 7px; font-size: 17px;}
    .explain { margin: 10px 0 0 0; color: #2941a5; font-size: 16px; }
    .mae-exp { color: #1976d2; font-size:15px; margin: 10px 0 0 0;}
    .warn { color:#b71c1c; background: #fff3e0; border-radius:7px; margin:9px 0 0 0; padding:6px 12px; display:inline-block;}
    .sol { background:#e9f5ff; border-radius: 7px; color:#0d47a1; padding:12px 14px; margin:12px 0 7px 0; font-size:15px;}
    .done-box { text-align:center; margin:57px 0 46px 0; padding:36px 8px 26px 8px; background:#e3f4fa; border-radius:20px; border:2.3px solid #2980b9; color:#17406a; font-size:23px;}
    .hide { display:none !important;}
    .show { display:block !important;}
    .compare-table { border-collapse: collapse; margin: 13px 0; font-size: 15px; border-radius:8px; overflow:hidden;}
    .compare-table th, .compare-table td { border: 1px solid #bbc; padding: 6px 12px; text-align: center; }
    .compare-table th { background: #e4ecff; }
    .judge-box { margin: 12px 0 0 0; padding: 11px 18px; border: 2px solid #9ec7ff; border-radius: 13px; background: #f2f8ff;}
    .ai-desc { margin: 11px 0 0 0; color: #186; font-size: 15px; line-height: 1.65;}
    .match-score { margin: 12px 0; font-size: 17px; font-weight: bold; }
    .match-score.good { color: #008060; }
    .match-score.soso { color: #d2691e; }
    .match-score.bad { color: #b71c1c; }
    #ctBox .judge-box { background:#fffde7; border:2px solid #ffd600; font-size: 1.05rem;}
    #ctBox ul { margin:7px 0 9px 10px; padding-left: 14px;}
    #ctStudentInput {font-family: 'Segoe UI', 'Arial'; font-size:1rem;}
    @media (max-width:700px) {
      .problem-box, .qbox {padding:10px;}
      .choice-tbl {width:100%;}
      .compare-table {font-size:14px;}
      .ai-desc {font-size:13px;}
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <h1>ğŸ¦« ë¹„ë²„ì±Œë¦°ì§€: AI ê°•ìˆ˜í™•ë¥  ê¸°ë°˜ ìš°ì‚° ì˜ˆì¸¡ê¸°</h1>
  <h2>ê³ 1 ìˆ˜í•™(í•¨ìˆ˜Â·ë°ì´í„° í•´ì„) + ê³ 2 í†µê³„Â·CT(ë¬¸ì œë¶„í•´/ì¶”ìƒí™”) í†µí•© ì‹¤ìŠµ</h2>
  <div class="section">
    <strong>ì§€ë¬¸:</strong>
    <p>
      ë³¸ ì˜ˆì¸¡ê¸°ëŠ” <b>êµ¬ë¦„ëŸ‰(C), ìŠµë„(H), í’ì†(W), ê¸°ì˜¨(T)</b>ì„ ê¸°ë°˜ìœ¼ë¡œ<br>
      <b>ë‚˜ì˜ ê°€ì¤‘ì¹˜</b>ì™€ <b>AI íšŒê·€ëª¨ë¸</b>ì´ ê°ê° ìš°ì‚° íœ´ëŒ€ í•„ìš”ì„±(í•„ìˆ˜/ê¶Œì¥/ì„ íƒ)ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.<br>
      ì˜ˆì¸¡ ê³µì‹: <b>P = wâ‚Ã—C + wâ‚‚Ã—H + wâ‚ƒÃ—W + wâ‚„Ã—T</b> (P=ê°•ìˆ˜í™•ë¥ , wâ‚~wâ‚„ì˜ í•©ì€ 1)<br>
      (Pâ‰¥70: í•„ìˆ˜, 50â‰¤P&lt;70: ê¶Œì¥, P&lt;50: ì„ íƒ)
    </p>
  </div>
  <div class="section">
    <strong>í™œë™ ê·œì¹™:</strong>
    <ul>
      <li>ì§€ë„ í´ë¦­ ë˜ëŠ” ìœ„ë„Â·ê²½ë„ ì…ë ¥ â†’ ìœ„ì¹˜ ì§€ì •</li>
      <li>ë‚ ì§œ ì„ íƒ (ì˜¤ëŠ˜/5ì¼ ì¤‘ í•˜ë‚˜, ë‹¬ë ¥ ê°€ëŠ¥)</li>
      <li>ê°€ì¤‘ì¹˜(0~1, í•© 1) ì…ë ¥ (êµ¬ë¦„ëŸ‰/ìŠµë„/í’ì†/ê¸°ì˜¨)</li>
      <li>ì˜ˆì¸¡ ê²°ê³¼: <b>ë‚´ ê°€ì¤‘ì¹˜/AIëª¨ë¸/ì‹¤ì œ ê°•ìˆ˜í™•ë¥  ëª¨ë‘ ê·¸ë˜í”„Â·í‘œë¡œ ë¹„êµ</b></li>
      <li>ë¬¸ì œí’€ì´: <b>ë‘˜ ì¤‘ ì–´ëŠ ìª½ ì˜ˆì¸¡ì´ ì‹¤ì œì™€ ë” ê°€ê¹Œìš´ì§€, CT ì‚¬ê³ ë ¥ ë¬¸í•­ í¬í•¨</b></li>
      <li><b>AI ëª¨ë¸ ì„¤ëª…:</b> ìµœê·¼ 20ì¼ ì‹¤ì œ ë°ì´í„°ë¡œ ë‹¤ì¤‘íšŒê·€, ì˜ˆì¸¡ê°’ê³¼ ì‹¤ì œê°’ì˜ í‰ê·  ì˜¤ì°¨ê¹Œì§€ ìë™ ë³´ì •í•´ ì‹¤ì œì™€ ë§¤ìš° ìœ ì‚¬í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.</li>
    </ul>
  </div>
  <div class="problem-box">
    <div id="map"></div>
    <div>
      <label>ğŸ“Œ ìœ„ë„</label>
      <input type="number" id="lat" value="37.5665" step="0.0001" />
      <label>ğŸ“Œ ê²½ë„</label>
      <input type="number" id="lon" value="126.9780" step="0.0001" />
      <label>ğŸ“… ë‚ ì§œ ì„ íƒ</label>
      <input type="date" id="selectedDate" />
    </div>
    <div style="margin-top: 16px">
      <h3 style="margin-bottom:6px;">ğŸ§ª ê°€ì¤‘ì¹˜ ì„¤ì • (0~1, í•©ì´ 1)</h3>
      <label>êµ¬ë¦„ëŸ‰:</label><input type="number" id="w_cloud" value="0.5" step="0.1" min="0" max="1" style="width:60px;">
      <label>ìŠµë„:</label><input type="number" id="w_humidity" value="0.2" step="0.1" min="0" max="1" style="width:60px;">
      <label>í’ì†:</label><input type="number" id="w_wind" value="0.2" step="0.1" min="0" max="1" style="width:60px;">
      <label>ê¸°ì˜¨:</label><input type="number" id="w_temp" value="0.1" step="0.1" min="0" max="1" style="width:60px;">
      <span id="weightWarn" class="warn" style="display:none"></span>
      <button class="btn" id="btnPredict" onclick="predictAll()">ğŸŒ¤ ì˜ˆì¸¡í•˜ê¸°</button>
    </div>
    <div>
      <div id="aiModelDesc" class="ai-desc" style="display:none"></div>
      <div id="resultPanel"></div>
      <div id="compareBox"></div>
      <div id="ctBox"></div>
      <div id="matchScoreBox" class="match-score"></div>
    </div>
    <div class="chart-switch">
      <button id="chartTab1" onclick="showChartTab('day')" class="selected">í•˜ë£¨ ì˜ˆì¸¡</button>
      <button id="chartTab5" onclick="showChartTab('5day')">5ì¼ ì˜ˆì¸¡</button>
    </div>
    <canvas id="chartDay" width="480" height="220" style="display:"></canvas>
    <canvas id="chart5day" width="600" height="260" style="display:none"></canvas>
  </div>
  <!-- ==== ë¬¸ì œí’€ì´ ì„¤ì •/íƒ€ì´ë¨¸/ë¬¸í•­ ==== -->
  <div class="problem-box" id="settingBox">
    <label>âŒ› ë¬¸ì œ í’€ì´ ì‹œê°„ ì„ íƒ: </label>
    <select id="timeSel">
      <option value="30">30ì´ˆ</option>
      <option value="60" selected>1ë¶„</option>
      <option value="90">1ë¶„ 30ì´ˆ</option>
      <option value="120">2ë¶„</option>
    </select>
    <button class="btn" onclick="resetQ1();resetQ2();startQuiz()">ë¬¸ì œ í’€ê¸° ì‹œì‘</button>
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
    <div class="timer-row" id="timerRow" style="display:none;">â± ë‚¨ì€ ì‹œê°„: <span id="timer">--</span></div>
  </div>
  <div class="qbox not-started" id="q1box">
    <div class="qtitle">ë¬¸ì œ 1. [ê°•ìˆ˜í™•ë¥  4ì§€ì„ ë‹¤]</div>
    <div class="qdesc" id="q1-input"></div>
    <table class="choice-tbl" id="q1-tbl"></table>
    <div class="choices" id="q1-choice"></div>
    <div class="ansMsg" id="ans1msg"></div>
    <div id="q1sol"></div>
  </div>
  <div class="qbox not-started" id="q2box">
    <div class="qtitle">ë¬¸ì œ 2. [ê°•ìˆ˜í™•ë¥  ì—­ì‚°]</div>
    <div class="qdesc" id="q2desc"></div>
    <div class="qrule" id="q2rule"></div>
    <div class="choices" id="q2-choice"></div>
    <div class="ansMsg" id="ans2msg"></div>
    <div id="q2sol"></div>
  </div>
  <div id="doneBox" class="done-box hide">
    <div>ğŸ‘ ëª¨ë“  ë¬¸ì œë¥¼ í’€ì´í•˜ì…¨ìŠµë‹ˆë‹¤!</div>
    <button class="btn" onclick="retryQuiz()">ë¬¸ì œ ë‹¤ì‹œ í’€ê¸°</button>
  </div>
  <script>
    // ì§€ë„/ì´ˆê¸°í™”
    let myMap;
    window.onload = () => {
      myMap = L.map('map').setView([37.5665, 126.9780], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(myMap);
      let marker;
      myMap.on('click', function(e) {
        const { lat, lng } = e.latlng;
        document.getElementById('lat').value = lat.toFixed(4);
        document.getElementById('lon').value = lng.toFixed(4);
        if (marker) myMap.removeLayer(marker);
        marker = L.marker([lat, lng]).addTo(myMap);
      });
      weightInputs.forEach(input => input.addEventListener('input', weightCheck));
      weightCheck();
      todayToDateInput();
    };
    function todayToDateInput() {
      const d = new Date();
      document.getElementById('selectedDate').value = d.toISOString().split('T')[0];
    }
    // ì°¨íŠ¸íƒ­
    function showChartTab(tab) {
      document.getElementById('chartTab1').classList.remove('selected');
      document.getElementById('chartTab5').classList.remove('selected');
      if(tab==='day') {
        document.getElementById('chartTab1').classList.add('selected');
        document.getElementById('chartDay').style.display = '';
        document.getElementById('chart5day').style.display = 'none';
      } else {
        document.getElementById('chartTab5').classList.add('selected');
        document.getElementById('chartDay').style.display = 'none';
        document.getElementById('chart5day').style.display = '';
      }
    }
    // ê°€ì¤‘ì¹˜ ì…ë ¥ ì²´í¬
    const weightInputs = [
      document.getElementById('w_cloud'),
      document.getElementById('w_humidity'),
      document.getElementById('w_wind'),
      document.getElementById('w_temp')
    ];
    function weightCheck() {
      let sum = 0;
      for(let i=0; i<weightInputs.length; i++) sum += parseFloat(weightInputs[i].value) || 0;
      if(sum > 1.00001) {
        document.getElementById('weightWarn').innerText = "ê°€ì¤‘ì¹˜ í•©ê³„ê°€ 1ì„ ë„˜ì—ˆìŠµë‹ˆë‹¤.";
        document.getElementById('weightWarn').style.display = '';
        document.getElementById('btnPredict').disabled = true;
        return false;
      } else {
        document.getElementById('weightWarn').innerText = "";
        document.getElementById('weightWarn').style.display = 'none';
        document.getElementById('btnPredict').disabled = false;
        return true;
      }
    }
    // =========== AI ëª¨ë¸(ê°•ìˆ˜í™•ë¥ ) ë‹¤ì¤‘íšŒê·€+ì˜¤í”„ì…‹ ë³´ì • ==============
    async function fitAIMultiLinear(lat, lon, startDate, days) {
      // 30ì¼ì¹˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ìµœê·¼ 20ì¼ í•™ìŠµ, ë¯¸ë˜ 5ì¼ ì˜ˆì¸¡ì— ì‚¬ìš©
      const nTrain = 20; // í•™ìŠµì¼ ìˆ˜ (ê¸°ì¡´ 7ì¼ â†’ 20ì¼)
      const nData = 30;  // ì „ì²´ ë°ì´í„° í™•ë³´ (í•™ìŠµ+ê²€ì¦ìš©)
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`
        + `&daily=precipitation_probability_mean,cloudcover_mean,relative_humidity_2m_max,windspeed_10m_max,temperature_2m_max&timezone=auto`
        + `&start_date=${getNextDate(startDate, -nData)}&end_date=${getNextDate(startDate, days+4)}`;
      const res = await fetch(url);
      const data = await res.json();
      const P = data.daily.precipitation_probability_mean; // ì‹¤ì œê°’
      const C = data.daily.cloudcover_mean;
      const H = data.daily.relative_humidity_2m_max;
      const W = data.daily.windspeed_10m_max;
      const T = data.daily.temperature_2m_max;
      // í•™ìŠµë°ì´í„°: ìµœê·¼ nTrainì¼
      let X = [], Y = [];
      for(let i=0; i<nTrain; i++) {
        X.push([1, C[i], H[i], W[i], T[i]]);
        Y.push(P[i]);
      }
      // ì •ê·œë°©ì •ì‹
      const math = window.math = window.math || await importMath();
      function leastSquares(X, Y) {
        const XT = math.transpose(X);
        const XTX = math.multiply(XT, X);
        const XTY = math.multiply(XT, Y);
        const coeffs = math.lusolve(XTX, XTY).map(r=>r[0]);
        return coeffs;
      }
      const coeffs = leastSquares(X, Y);
      // ì˜ˆì¸¡ê°’ì„ ì‹¤ì œê°’ì— ë§ê²Œ ë³´ì •(ì „ì²´ ë°ì´í„°ì— ëŒ€í•´ í‰ê·  ì˜¤ì°¨ë¥¼ ì‚°ì¶œ, ì˜¤í”„ì…‹ ë³´ì •)
      let errSum = 0;
      for(let i=0; i<nTrain; i++) {
        const pred = coeffs[0] + coeffs[1]*C[i] + coeffs[2]*H[i] + coeffs[3]*W[i] + coeffs[4]*T[i];
        errSum += (P[i] - pred);
      }
      const offset = errSum / nTrain; // í‰ê·  ì˜¤ì°¨
      // offsetì„ íšŒê·€ê³„ìˆ˜ ì ˆí¸ì— ë”í•´ ì‹¤ì œì™€ ì°¨ì´ê°€ ë‚˜ì§€ ì•Šê²Œ ë³´ì •
      coeffs[0] += offset;
      return { coeffs, data: {P,C,H,W,T}, dates: data.daily.time, offset, nTrain };
    }
    async function importMath() {
      if(window.math) return window.math;
      return await new Promise((resolve)=>{
        const script = document.createElement('script');
        script.src = "https://cdn.jsdelivr.net/npm/mathjs@11.9.1/lib/browser/math.js";
        script.onload = ()=>{ resolve(window.math); };
        document.head.appendChild(script);
      });
    }
    // ë‚ ì§œ ì¡°ì‘
    function getNextDate(date, diff) {
      let d = new Date(date);
      d.setDate(d.getDate()+diff);
      return d.toISOString().split('T')[0];
    }
    // ========================= ì˜ˆì¸¡ ì „ì²´ =========================
    async function predictAll() {
      if(!weightCheck()) return;
      const lat = document.getElementById('lat').value;
      const lon = document.getElementById('lon').value;
      const selDate = document.getElementById('selectedDate').value;
      // ëª¨ë¸ í•™ìŠµ (ìµœê·¼ 20ì¼)
      const model = await fitAIMultiLinear(lat, lon, selDate, 5);
      // ì˜¤ëŠ˜+5ì¼ ëª¨ë‘ ë°ì´í„° ê°€ì ¸ì˜´
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`
        + `&daily=precipitation_probability_mean,cloudcover_mean,relative_humidity_2m_max,windspeed_10m_max,temperature_2m_max&timezone=auto`
        + `&start_date=${selDate}&end_date=${getNextDate(selDate,4)}`;
      const res = await fetch(url);
      const data = await res.json();
      let days = [];
      for(let i=0;i<data.daily.time.length;i++) {
        days.push({
          date: data.daily.time[i],
          P_real: data.daily.precipitation_probability_mean[i], // ì‹¤ì œ ê°•ìˆ˜í™•ë¥ 
          C: data.daily.cloudcover_mean[i],
          H: data.daily.relative_humidity_2m_max[i],
          W: data.daily.windspeed_10m_max[i],
          T: data.daily.temperature_2m_max[i]
        });
      }
      // ======== ë‚´ ê°€ì¤‘ì¹˜/AI ì˜ˆì¸¡ ë™ì‹œ ê³„ì‚° =========
      const wr = parseFloat(document.getElementById("w_cloud").value);
      const wh = parseFloat(document.getElementById("w_humidity").value);
      const ww = parseFloat(document.getElementById("w_wind").value);
      const wt = parseFloat(document.getElementById("w_temp").value);
      for(let i=0;i<days.length;i++) {
        // ë‚´ ê°€ì¤‘ì¹˜ ì˜ˆì¸¡
        days[i].P_user = wr*days[i].C + wh*days[i].H + ww*days[i].W + wt*days[i].T;
        // AI ì˜ˆì¸¡ (ë‹¤ì¤‘íšŒê·€)
        let X = [1, days[i].C, days[i].H, days[i].W, days[i].T];
        days[i].P_ai = model.coeffs[0] + model.coeffs[1]*days[i].C + model.coeffs[2]*days[i].H + model.coeffs[3]*days[i].W + model.coeffs[4]*days[i].T;
        days[i].P_ai = Math.max(0, Math.min(100, days[i].P_ai));
      }
      // AI ëª¨ë¸ ì„¤ëª… ê°•í™” (ì˜¤í”„ì…‹ ë³´ì •ê¹Œì§€ ì•ˆë‚´)
      let desc = `<b>[AI ëª¨ë¸: ë‹¤ì¤‘íšŒê·€ + í‰ê·  ì˜¤ì°¨ ë³´ì •]</b><br>
      ì´ AI ëª¨ë¸ì€ ìµœê·¼ 20ì¼ê°„ì˜ ì‹¤ì œ ë‚ ì”¨ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬,<br>
      <b>ê°•ìˆ˜í™•ë¥ (P)</b>ì´ êµ¬ë¦„ëŸ‰(C), ìŠµë„(H), í’ì†(W), ê¸°ì˜¨(T)ì— ì–´ë–»ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ <b>ë‹¤ì¤‘ì„ í˜•íšŒê·€</b>ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.<br>
      í•™ìŠµ ê³¼ì •ì—ì„œ ëª¨ë¸ ì˜ˆì¸¡ê°’ì´ ì‹¤ì œê°’ê³¼ í‰ê· ì ìœ¼ë¡œ ì¼ì¹˜í•˜ë„ë¡,<br>
      <b>ì „ì²´ í‰ê·  ì˜¤ì°¨(offset)ë¥¼ ìë™ ë³´ì •</b>í•˜ì—¬ AI ì˜ˆì¸¡ê°’ì´ ì‹¤ì œì— ìµœëŒ€í•œ ìœ ì‚¬í•˜ê²Œ ë‚˜ì˜¤ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.<br>
      íšŒê·€ì‹:<br>
      P = ${model.coeffs[0].toFixed(2)} + ${model.coeffs[1].toFixed(3)}Ã—C + ${model.coeffs[2].toFixed(3)}Ã—H + ${model.coeffs[3].toFixed(3)}Ã—W + ${model.coeffs[4].toFixed(3)}Ã—T<br>
      (ìµœê·¼ ${model.nTrain}ì¼ ì‹¤ì œ ë°ì´í„°ë¡œ í•™ìŠµ, í‰ê·  ì˜¤ì°¨(offset)=${model.offset.toFixed(2)})`;
      document.getElementById('aiModelDesc').innerHTML = desc;
      document.getElementById('aiModelDesc').style.display = '';
      // í•˜ë£¨/5ì¼ ì˜ˆì¸¡ ê·¸ë˜í”„
      drawChartDay(days[0]);
      drawChart5day(days);
      // ì˜ˆì¸¡ ë¹„êµ í‘œ ë° ê²°ê³¼ + CT
      renderCompare(days);
      // ì¼ì¹˜ê°œìˆ˜ íŒì •
      showMatchScore(days);
      // ë¬¸ì œ ë¬¸í•­ ë°˜ì˜(ë¬¸ì œí’€ì´ì— í™œìš©)
      window.day_for_quiz = days[0]; // 1ì¼ì¹˜ ë¬¸ì œí’€ì´ìš©
    }
    // í•˜ë£¨ ì˜ˆì¸¡ ê·¸ë˜í”„: ì‹¤ì œ, ë‚´ ê°€ì¤‘ì¹˜, AIëª¨ë¸
    function drawChartDay(day) {
      const ctx = document.getElementById("chartDay").getContext("2d");
      if (window.chartDay instanceof Chart) window.chartDay.destroy();
      window.chartDay = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['ì‹¤ì œ ê°•ìˆ˜í™•ë¥ ', 'ë‚˜ì˜ ê°€ì¤‘ì¹˜ ì˜ˆì¸¡', 'AI ëª¨ë¸ ì˜ˆì¸¡'],
          datasets: [{
            label: day.date,
            data: [Number(day.P_real.toFixed(1)), Number(day.P_user.toFixed(1)), Number(day.P_ai.toFixed(1))],
            backgroundColor: ['#0097a7', '#3949ab', '#c62828']
          }]
        },
        options: {
          plugins: {
            title: { display: true, text: 'ğŸŒ§ í•˜ë£¨ ì˜ˆì¸¡(ê°•ìˆ˜í™•ë¥ , ì˜ˆì¸¡ê°’ ë¹„êµ)' },
            datalabels: {
              anchor: 'end',
              align: 'end',
              formatter: (val) => val.toFixed(1),
              font: { weight: 'bold' }
            }
          },
          scales: { y: { beginAtZero: true, max: 100 } }
        },
        plugins: [ChartDataLabels]
      });
    }
    // 5ì¼ ì˜ˆì¸¡ ê·¸ë˜í”„: ëª¨ë‘ ì¶œë ¥
    function drawChart5day(days) {
      const ctx = document.getElementById("chart5day").getContext("2d");
      if (window.chart5day instanceof Chart) window.chart5day.destroy();
      window.chart5day = new Chart(ctx, {
        type: 'line',
        data: {
          labels: days.map(d=>d.date),
          datasets: [
            {
              label: "ì‹¤ì œ ê°•ìˆ˜í™•ë¥ ",
              data: days.map(x => Number(x.P_real.toFixed(1))),
              borderColor: "#0097a7",
              fill: false
            },
            {
              label: "ë‚˜ì˜ ê°€ì¤‘ì¹˜ ì˜ˆì¸¡",
              data: days.map(x => Number(x.P_user.toFixed(1))),
              borderColor: "#3949ab",
              fill: false
            },
            {
              label: "AI ëª¨ë¸ ì˜ˆì¸¡",
              data: days.map(x => Number(x.P_ai.toFixed(1))),
              borderColor: "#c62828",
              fill: false
            }
          ]
        },
        options: {
          plugins: {
            title: { display: true, text: "ğŸ“… 5ì¼ ì˜ˆì¸¡(ê°•ìˆ˜í™•ë¥ , ì˜ˆì¸¡ê°’ ë¹„êµ)" },
            datalabels: {
              anchor: 'end',
              align: 'top',
              formatter: (val) => val.toFixed(1),
              font: { weight: 'bold' }
            }
          },
          scales: { y: { beginAtZero: true, max: 100, ticks: { stepSize: 10 } } }
        },
        plugins: [ChartDataLabels]
      });
    }
    // ë¹„êµí‘œ ë° íŒì • + CTë°•ìŠ¤
    function renderCompare(days) {
      // ë¶„ë¥˜ ê²°ê³¼
      function getResult(val) {
        if(val >= 70) return '<span class="í•„ìˆ˜">í•„ìˆ˜</span>';
        else if(val >= 50) return '<span class="ê¶Œì¥">ê¶Œì¥</span>';
        else return '<span class="ì„ íƒ">ì„ íƒ</span>';
      }
      let html = `<table class="compare-table">
        <tr><th>êµ¬ë¶„</th><th>ì‹¤ì œ ê°•ìˆ˜í™•ë¥ </th><th>ë‚˜ì˜ ê°€ì¤‘ì¹˜ ì˜ˆì¸¡</th><th>AI ëª¨ë¸ ì˜ˆì¸¡</th></tr>
        <tr>
          <th>í•˜ë£¨ ì˜ˆì¸¡</th>
          <td>${days[0].P_real.toFixed(1)} (${getResult(days[0].P_real)})</td>
          <td>${days[0].P_user.toFixed(1)} (${getResult(days[0].P_user)})</td>
          <td>${days[0].P_ai.toFixed(1)} (${getResult(days[0].P_ai)})</td>
        </tr>
      </table>
      <table class="compare-table"><tr><th>ë‚ ì§œ</th><th>ì‹¤ì œ ê°•ìˆ˜í™•ë¥ </th><th>ë‚˜ì˜ ì˜ˆì¸¡</th><th>AI ì˜ˆì¸¡</th></tr>`;
      for(let i=0;i<days.length;i++) {
        html += `<tr>
          <td>${days[i].date}</td>
          <td>${days[i].P_real.toFixed(1)} (${getResult(days[i].P_real)})</td>
          <td>${days[i].P_user.toFixed(1)} (${getResult(days[i].P_user)})</td>
          <td>${days[i].P_ai.toFixed(1)} (${getResult(days[i].P_ai)})</td>
        </tr>`;
      }
      html += `</table>
      <div class="judge-box"><b>[ë¶„ì„]</b><br>
      í•˜ë£¨ ì˜ˆì¸¡ì—ì„œ <b>ë‚˜ì˜ ê°€ì¤‘ì¹˜ì™€ AI ëª¨ë¸ ì˜ˆì¸¡</b> ì¤‘ <b>ì‹¤ì œ ê°•ìˆ˜í™•ë¥  ë¶„ë¥˜ì™€ ë” ì¼ì¹˜í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?</b><br>
      5ì¼ ì˜ˆì¸¡ì—ì„œ <b>í‰ê·  ì˜¤ì°¨(MAE)</b>ê°€ ë” ì‘ì€ ìª½ì€ ì–´ëŠ ìª½ì¸ê°€ìš”? <br>
      <span style="color:#888">ê·¸ë˜í”„, í‘œ, ì˜¤ì°¨ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ì§ì ‘ íŒë‹¨í•´ë³´ì„¸ìš”.</span></div>
      `;
      document.getElementById('compareBox').innerHTML = html;
      // MAE ê³„ì‚°
      const mae_user = (days.reduce((s,x)=>s+Math.abs(x.P_real-x.P_user),0)/days.length).toFixed(2);
      const mae_ai = (days.reduce((s,x)=>s+Math.abs(x.P_real-x.P_ai),0)/days.length).toFixed(2);
      document.getElementById('resultPanel').innerHTML = `<b>5ì¼ê°„ í‰ê·  ì˜¤ì°¨(MAE)</b> <br>
        ë‚˜ì˜ ì˜ˆì¸¡: <b>${mae_user}</b> &nbsp; | &nbsp; AI ëª¨ë¸ ì˜ˆì¸¡: <b>${mae_ai}</b>`;
      // CT ì‚¬ê³ ë ¥ ì‹¤ìŠµ ë°•ìŠ¤ ì¶”ê°€
      let ctHTML = `
        <div class="judge-box" style="background:#fffde7; border:2px solid #ffd600; margin-top:18px;">
          <b>CT ì‚¬ê³ ë ¥ ì‹¤ìŠµ: ë‚˜ì˜ ì˜ˆì¸¡ê°’ì´ AI ëª¨ë¸ê³¼ ìœ ì‚¬í•´ì§€ë ¤ë©´?</b><br>
          <ul>
            <li><b>ë¬¸ì œ ë¶„í•´:</b> ì˜ˆì¸¡ì— ì‚¬ìš©ëœ ê° ìš”ì†Œ(êµ¬ë¦„ëŸ‰, ìŠµë„, í’ì†, ê¸°ì˜¨)ê°€ ê²°ê³¼ì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ ë¶„ì„í•´ë³´ì„¸ìš”.</li>
            <li><b>íŒ¨í„´ ì¸ì‹:</b> AI ëª¨ë¸ê³¼ ë‚˜ì˜ ì˜ˆì¸¡ ê²°ê³¼ê°€ ë‹¤ë¥¼ ë•Œ ë°˜ë³µì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ê²½í–¥ì„±(íŒ¨í„´)ì´ ìˆëŠ”ì§€ ì°¾ì•„ë³´ì„¸ìš”.</li>
            <li><b>ì¶”ìƒí™”:</b> ë¶ˆí•„ìš”í•œ ìš”ì†Œë¥¼ ì¤„ì´ê³  ì˜ˆì¸¡ì— í•µì‹¬ì ìœ¼ë¡œ ì‘ìš©í•˜ëŠ” ë³€ìˆ˜ë¥¼ ì¶”ë ¤ë³´ì„¸ìš”.</li>
            <li><b>ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„:</b> ë‚´ê°€ ì…ë ¥í•œ ê°€ì¤‘ì¹˜ë¥¼ ì–´ë–»ê²Œ ì¡°ì •í•˜ë©´ AI ëª¨ë¸ì˜ íšŒê·€ê³„ìˆ˜ì™€ ë” ê°€ê¹Œì›Œì§ˆì§€ ì „ëµì„ ì„¸ì›Œë³´ì„¸ìš”.</li>
          </ul>
          <label for="ctStudentInput"><b>ì‹¤ìŠµ:</b> ìœ„ 4ë‹¨ê³„ë¥¼ ì°¸ê³ í•˜ì—¬, <u>ë‚´ ì˜ˆì¸¡ê°’ì´ AI ëª¨ë¸ ì˜ˆì¸¡ê°’ê³¼ ë” ìœ ì‚¬í•´ì§€ë ¤ë©´ ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ì§€</u> ê°„ë‹¨íˆ ì‘ì„±í•´ë³´ì„¸ìš”.</label><br>
          <textarea id="ctStudentInput" rows="3" style="width:98%; border-radius:8px; margin:6px 0;" placeholder="ì—¬ê¸°ì— ì‘ì„±í•˜ì„¸ìš”..."></textarea>
          <button class="btn" style="background:#ffeb3b; color:#0d224c; margin-top:7px;" onclick="showCTSampleAnswer()">ì˜ˆì‹œ ë‹µì•ˆ ë³´ê¸°</button>
          <div id="ctSampleAns" style="margin-top:8px; color:#314c92; font-size:15px; display:none;"></div>
        </div>
      `;
      document.getElementById('ctBox').innerHTML = ctHTML;
    }
    function showMatchScore(days) {
      let matchCount = 0;
      for(let i=0;i<days.length;i++) {
        const realType = getType(days[i].P_real);
        const userType = getType(days[i].P_user);
        if(realType === userType) matchCount++;
      }
      let msg = "";
      if(matchCount >= 4) {
        msg = "ğŸ‘ <span class='good'>íƒì›”í•´ìš”! 5ì¼ ì¤‘ " + matchCount + "ê°œ ì¼ì¹˜: ìš°ì‚° ì˜ˆì¸¡ì´ AI ëª¨ë¸ë§Œí¼ ì •í™•í•´ìš”.</span>";
      } else if(matchCount >= 2) {
        msg = "ğŸ‘Œ <span class='soso'>ì ì ˆí•´ìš”! 5ì¼ ì¤‘ " + matchCount + "ê°œ ì¼ì¹˜: ì–´ëŠ ì •ë„ ì ì ˆí•©ë‹ˆë‹¤.</span>";
      } else {
        msg = "ğŸ›  <span class='bad'>1ê°œ ì´í•˜: ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì •í•´ì„œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!</span>";
      }
      document.getElementById('matchScoreBox').innerHTML = msg;
    }
    function getType(v) { return v>=70?"í•„ìˆ˜":v>=50?"ê¶Œì¥":"ì„ íƒ"; }
    // CT ì˜ˆì‹œ ë‹µì•ˆ í† ê¸€ í•¨ìˆ˜
    function showCTSampleAnswer() {
      document.getElementById('ctSampleAns').style.display = '';
      document.getElementById('ctSampleAns').innerHTML = `
        <b>[ì˜ˆì‹œ ë‹µì•ˆ]</b><br>
        1. <b>ë¬¸ì œ ë¶„í•´</b>: ì˜ˆì¸¡ì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì†Œë³„(êµ¬ë¦„ëŸ‰, ìŠµë„, í’ì†, ê¸°ì˜¨) ì¤‘ìš”ë„ë¥¼ ë”°ë¡œ ë¶„ì„í•œë‹¤.<br>
        2. <b>íŒ¨í„´ ì¸ì‹</b>: AI ëª¨ë¸ê³¼ ë‚´ ì˜ˆì¸¡ì´ í¬ê²Œ ì°¨ì´ ë‚˜ëŠ” ë‚ ì—ëŠ” ì–´ë–¤ ë³€ìˆ˜ê°€ ì£¼ë¡œ ë‹¬ëëŠ”ì§€ ì°¾ì•„ë³¸ë‹¤.<br>
        3. <b>ì¶”ìƒí™”</b>: ì˜ˆì¸¡ì— ê±°ì˜ ì˜í–¥ì´ ì—†ëŠ” ë³€ìˆ˜ëŠ” ê°€ì¤‘ì¹˜ë¥¼ ì¤„ì´ê³ , ì‹¤ì œë¡œ ì˜í–¥ì´ í° ë³€ìˆ˜ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë†’ì¸ë‹¤.<br>
        4. <b>ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„</b>: AI íšŒê·€ê³„ìˆ˜ì™€ ë‚´ ê°€ì¤‘ì¹˜ ê°’ì„ ìµœëŒ€í•œ ìœ ì‚¬í•˜ê²Œ ë§ì¶”ì–´ ì…ë ¥í•´ ë³¸ë‹¤.<br>
        <u>ì´ë ‡ê²Œ CT ì‚¬ê³ ê³¼ì •ì„ í†µí•´ ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì •í•˜ë©´, AI ëª¨ë¸ê³¼ ë‚´ ì˜ˆì¸¡ì˜ ì°¨ì´ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.</u>
      `;
    }
    // ================= ë¬¸ì œ1 ëœë¤ìƒì„±/í’€ì´ =================
    let q1 = {}, solved1=false, solved2=false;
    function resetQ1() {
      let ok = false, tryCnt=0, maxTry=50;
      let C,H,W,T,weights,P,correctIdx;
      while(!ok && tryCnt<maxTry) {
        C = Math.floor(Math.random() * 31) + 70;
        H = Math.floor(Math.random() * 21) + 70;
        W = Math.floor(Math.random() * 6) + 2;
        T = Math.floor(Math.random() * 6) + 25;
        let idx = Math.floor(Math.random()*4);
        let wSet = [
          [0.7,0.1,0.1,0.1],
          [0.3,0.3,0.2,0.2],
          [0.1,0.3,0.4,0.2],
          [0.1,0.1,0.4,0.4]
        ];
        weights = [];
        for(let i=0;i<4;i++) weights.push(wSet[(i+idx)%4]);
        P = [];
        for(let i=0;i<4;i++) {
          let w = weights[i];
          P.push(w[0]*C + w[1]*H + w[2]*W + w[3]*T);
        }
        let nFil = 0, ansIdx=-1;
        for(let i=0;i<4;i++) if(P[i]>=70) { nFil++; ansIdx=i; }
        if(nFil===1 && ansIdx!==-1) { correctIdx=ansIdx; ok=true; break; }
        tryCnt++;
      }
      if(!ok) {
        C=80;H=80;W=7;T=27;
        weights=[[0.7,0.1,0.1,0.1],[0.3,0.3,0.2,0.2],[0.1,0.3,0.4,0.2],[0.1,0.1,0.4,0.4]];
        P = [0.7*C+0.1*H+0.1*W+0.1*T,0.3*C+0.3*H+0.2*W+0.2*T,0.1*C+0.3*H+0.4*W+0.2*T,0.1*C+0.1*H+0.4*W+0.4*T];
        correctIdx=0;
      }
      q1.C=C; q1.H=H; q1.W=W; q1.T=T; q1.weights=weights; q1.P = P; q1.right = String.fromCharCode(65+correctIdx);
      let tblHTML = `<tr>
        <th>ë³´ê¸°</th><th>wâ‚(C)</th><th>wâ‚‚(H)</th><th>wâ‚ƒ(W)</th><th>wâ‚„(T)</th>
      </tr>`;
      let choiceHTML = '';
      for(let i=0; i<4; i++) {
        let w = weights[i], label=String.fromCharCode(65+i);
        tblHTML += `<tr>
          <td>${label}</td><td>${w[0]}</td><td>${w[1]}</td><td>${w[2]}</td><td>${w[3]}</td>
        </tr>`;
        choiceHTML += `<button onclick="ans1('${label}')">${label}</button>`;
      }
      document.getElementById('q1-input').innerText = `C=${C}, H=${H}, W=${W}, T=${T}`;
      document.getElementById('q1-tbl').innerHTML = tblHTML;
      document.getElementById('q1-choice').innerHTML = choiceHTML;
      document.getElementById('ans1msg').innerHTML = '';
      document.getElementById('q1sol').innerHTML = '';
      solved1 = false;
      solved2 = false;
      document.getElementById('q1box').classList.remove('hide');
      document.getElementById('q2box').classList.remove('hide');
      document.getElementById('doneBox').classList.add('hide');
    }
    function ans1(sel) {
      if(solved1) return;
      let idx = sel.charCodeAt(0)-65;
      let w = q1.weights;
      let calcstr = w.map((v,i)=>{
        return `${String.fromCharCode(65+i)} : ${v[0]}Ã—${q1.C} + ${v[1]}Ã—${q1.H} + ${v[2]}Ã—${q1.W} + ${v[3]}Ã—${q1.T} = ${q1.P[i].toFixed(1)} â†’ ${q1.P[i]>=70?'í•„ìˆ˜':q1.P[i]>=50?'ê¶Œì¥':'ì„ íƒ'}`;
      }).join('<br>');
      let sol = `<div class="sol"><b>[í’€ì´ê³¼ì •]</b><br>
        1. ì…ë ¥ê°’ê³¼ ê° ë³´ê¸°ì˜ ê°€ì¤‘ì¹˜ë¥¼ í™•ë¥ ì‹ì— ëŒ€ì…<br>
        2. ê³„ì‚° ê²°ê³¼ Pê°€ 70 ì´ìƒì¸ ë³´ê¸°ë¥¼ ì°¾ìŒ<br>
        3. ì˜¤ì§ í•˜ë‚˜ì˜ ë³´ê¸°ë§Œ Pâ‰¥70(í•„ìˆ˜)ì´ë¯€ë¡œ í•´ë‹¹ ë³´ê¸°ê°€ ì •ë‹µ<br><br>${calcstr}<br>
        ì •ë‹µ: ${q1.right} (P=${q1.P[q1.right.charCodeAt(0)-65].toFixed(1)})</div>`;
      if(sel === q1.right) {
        document.getElementById("ans1msg").innerHTML = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        document.getElementById("ans1msg").innerHTML = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. (ì •ë‹µ: ${q1.right})`;
      }
      document.getElementById('q1sol').innerHTML = sol;
      solved1=true;
      checkFinish();
    }
    // =============== ê³„ì‚°í˜•(ì •ìˆ˜í•´) 4ì§€ì„ ë‹¤ ë¬¸í•­2 ================
    let q2 = {};
    function resetQ2() {
      let ok=false, tryCnt=0, ans=-1, w1,w2,w3,w4,H,W,T,Pmin,solC,choices=[];
      while(!ok && tryCnt<200) {
        w1 = (Math.random()*0.25+0.5).toFixed(2)*1;
        w2 = (Math.random()*0.25+0.1).toFixed(2)*1;
        w3 = (Math.random()*0.2+0.1).toFixed(2)*1;
        w4 = +(1.0-w1-w2-w3).toFixed(2);
        if(w4<0.05||w4>0.3) { tryCnt++; continue; }
        H = Math.floor(Math.random()*16)+75;
        W = Math.floor(Math.random()*6)+3;
        T = Math.floor(Math.random()*6)+25;
        Pmin = w2*H + w3*W + w4*T;
        solC = Math.round((70-Pmin)/w1);
        if(solC<0 || solC>100 || Math.abs(w1*solC+Pmin-70)>0.95) { tryCnt++; continue; }
        let used = new Set([solC]);
        choices = [solC];
        while(choices.length<4) {
          let offset = Math.floor(Math.random()*9)+2;
          let sign = Math.random()<0.5?-1:1;
          let v = solC + offset*sign;
          if(v<0||v>100||used.has(v)) continue;
          used.add(v);
          choices.push(v);
        }
        for(let i=choices.length-1;i>0;i--){
          let j=Math.floor(Math.random()*(i+1));
          [choices[i],choices[j]]=[choices[j],choices[i]];
        }
        ans=choices.indexOf(solC);
        ok=true;
      }
      q2 = {w1,w2,w3,w4,H,W,T,Pmin,solC,choices,ans};
      document.getElementById('q2desc').innerHTML = `ìš°ì‚° ì˜ˆì¸¡ ê³µì‹ <b>P = wâ‚Ã—C + wâ‚‚Ã—H + wâ‚ƒÃ—W + wâ‚„Ã—T</b> (ë‹¨, 0â‰¤Câ‰¤100)ì—ì„œ<br>
        wâ‚=${w1}, wâ‚‚=${w2}, wâ‚ƒ=${w3}, wâ‚„=${w4}, H=${H}, W=${W}, T=${T}ì¼ ë•Œ,<br>
        <b>ìš°ì‚° í•„ìˆ˜(Pâ‰¥70)ê°€ ë˜ë ¤ë©´ êµ¬ë¦„ëŸ‰ Cê°€ ìµœì†Œ ëª‡ ì´ìƒì´ì–´ì•¼ í•˜ëŠ”ê°€?</b>`;
      document.getElementById('q2rule').innerHTML = `
        <b>ê·œì¹™:</b><br>
        1. ì‹ì— ëª¨ë“  ê°’ì„ ëŒ€ì…í•´ í’€ ê²ƒ<br>
        2. 70 = wâ‚C + wâ‚‚H + wâ‚ƒW + wâ‚„T ì´ë¯€ë¡œ, Cë¥¼ ê³„ì‚°<br>
        3. ë³´ê¸° ì¤‘ ì˜¬ë°”ë¥¸ ì •ìˆ˜í•´ë¥¼ ê³ ë¥´ì„¸ìš”.
      `;
      let btns = "";
      for(let i=0;i<4;i++)
        btns += `<button onclick="ans2(${i})">${q2.choices[i]}</button>`;
      document.getElementById('q2-choice').innerHTML = btns;
      document.getElementById('ans2msg').innerHTML = "";
      document.getElementById('q2sol').innerHTML = "";
      solved2 = false;
    }
    function ans2(idx) {
      if(solved2) return;
      let exp = `â‘  ëª¨ë“  ìƒìˆ˜ ëŒ€ì…: 70 = (${q2.w1})C + (${q2.w2})Ã—${q2.H} + (${q2.w3})Ã—${q2.W} + (${q2.w4})Ã—${q2.T}
      <br>â‘¡ ${q2.w1}C = 70 - [${q2.w2}Ã—${q2.H} + ${q2.w3}Ã—${q2.W} + ${q2.w4}Ã—${q2.T}]
      <br>â‘¢ C = (70 - (${q2.w2*q2.H}+${q2.w3*q2.W}+${q2.w4*q2.T}).toFixed(2)) / ${q2.w1} â‰ˆ <b>${q2.solC}</b>
      <br>â‘£ ì •ë‹µ: <b>${q2.solC}</b> (êµ¬ë¦„ëŸ‰ ìµœì†Œê°’)`;
      if(idx===q2.ans) {
        document.getElementById('ans2msg').innerHTML = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        document.getElementById('ans2msg').innerHTML = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. (ì •ë‹µ: ${q2.solC})`;
      }
      document.getElementById('q2sol').innerHTML = `<div class="sol"><b>[í’€ì´ê³¼ì •]</b><br>${exp}</div>`;
      solved2 = true;
      checkFinish();
    }
    function checkFinish() {
      if(solved1 && solved2) {
        setTimeout(()=>{
          document.getElementById('doneBox').classList.remove('hide');
          document.getElementById('q1box').classList.remove('started');
          document.getElementById('q2box').classList.remove('started');
          document.getElementById('q1box').classList.add('not-started');
          document.getElementById('q2box').classList.add('not-started');
        }, 500);
      }
    }
    // íƒ€ì´ë¨¸/ì§„í–‰ ë“±(ë™ì¼)
    let time=0, remain=0, interval=null;
    function startQuiz(){
      document.getElementById('settingBox').style.pointerEvents='none';
      document.getElementById('settingBox').style.opacity='0.6';
      document.getElementById('q1box').classList.remove('not-started','hide');
      document.getElementById('q1box').classList.add('started');
      document.getElementById('q2box').classList.remove('not-started','hide');
      document.getElementById('q2box').classList.add('started');
      document.getElementById('timerRow').style.display='';
      time = Number(document.getElementById("timeSel").value);
      remain = time;
      document.getElementById("timer").innerText = remain;
      document.getElementById("progressBar").style.width = "100%";
      interval = setInterval(()=>{
        remain--;
        document.getElementById("timer").innerText = remain;
        document.getElementById("progressBar").style.width = (remain/time*100) + "%";
        if(remain<=0){
          clearInterval(interval);
          showTimeout();
        }
      }, 1000);
    }
    function showTimeout(){
      alert("â° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”.");
      document.getElementById('q1box').style.pointerEvents='none';
      document.getElementById('q2box').style.pointerEvents='none';
      document.getElementById('q1box').style.opacity='0.5';
      document.getElementById('q2box').style.opacity='0.5';
    }
    function retryQuiz(){
      location.reload();
    }
  </script>
</body>
</html>
